# Rspec 深掘り

# devise token authの認証を通したテスト

## RSpec FactoryBot使い方
[[Rspec]Factorybotのtransientとevaluatorを使ってテストデータを作る](https://zenn.dev/groove_harbor/articles/ae07119d938cf2)

## Rspec Factorybot sequence
[Rspec,FactoryBotのsequence](https://qiita.com/9-michi-9/items/fa009d725dfeba56b22a)


# 既存の`location_posts_controller`のテストを改修

`spec/factories/user.rb`
```ruby
FactoryBot.define do
    factory :user do
        name { 'Test' }
        sequence :email do |n|
            "ass#{n}@test.com"
        end
        password { 'password1234' }

    end
end  
```

`spec/factories/location_post.rb`
```ruby
FactoryBot.define do
    factory :location_post do
        association :user
        title { "サンプル投稿" }
        address { "Test City" }
        description { "test" }
    end
end  
```

`spec/api/location_posts_controller_spec.rb`
```ruby
require 'rails_helper'

RSpec.describe Api::V1::LocationPostsController, type: :controller do
    describe "GET #index" do
        it "returns a success response" do
            get :index
            expect(response).to be_successful
        end
    end

    describe "GET #show" do
        let(:location_post) { create(:location_post) }

        it "returns a success response" do
            get :show, params: { id: location_post.id }
            expect(response).to be_successful
        end
    end
end
```

