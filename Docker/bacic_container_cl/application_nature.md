# コンテナ化されるアプリケーションに必要な性質

## アプリケーションの実装・アーキテクチャに関するトピック

### ステートレスな状態を維持する
- キャッシュやセッション情報はアプリにもたない
  - どのコンテナでも処理ができるようにしてスケーラビリティ、UIUXを向上させる
  - アプリケーション内にキャッシュを持つとしても暖気不要な軽量キャッシュのみにとどめる
- ステートレスなアプリケーションが必要な状況
  - スケールイン、スケールアウト時
  - コンテナの障害時

### スケールアウト可能なアーキテクチャ
- スケールアップではなくスケールアウトで性能向上をしやすく
  - 平行スケールと垂直スケールの話  
  - マイクロサービスアーキテクチャの採用
    - サービス間通信を行い、細かい単位でスケールアウトできるように
    - コンテナをデプロイするVMの枠には限りがある、そのためできるだけ細かいコンテナが良い
  - イベント駆動アーキテクチャの採用
  - ステートレスな状態を維持する

### 設定は外部から注入できるようにする
- コンテナ(プロセス)の挙動を容易に外部から変えられるようにする
  - DBの接続情報
  - アプリケーションの並列数
  - STG/PRDなどの環境
- 設定ファイルや環境変数は基本的にコンテナイメージに含めない
- STGとPRDで同じコンテナイメージを利用する
- 環境変数で切り替える
  - 設定項目が少ない場合に有効
- 設定ファイルを渡して切り替える
  - 設定項目が多い場合や、設定に階層構造を持つ場合に適切
