# 文体修正

<プロジェクト概要>

お客様のバイクのレンタルサービスの開発・運用保守業務を行なっております。
システムの技術スタックとしましてはフロントエンド...Vue.js,バックエンド　...RubyonRails,インフラ...AWS(ECS,Aurora(MySQL)),請求機能...Stripeといった構成になっておりました。
私の担当業務としてはシステム全般を担当しており、フロントエンドであればUI改修業務、バックエンドであればAPI改修やパッチファイルの作成、インフラであればバッチの実行時間調整やリソースのコストカットなどの業務を担当しておりました。

<課題>

私が開発・運用保守を担当していたレンタルサービスでは、商品のレンタル期間の日数が固定されており、お客様がレンタル期間より延滞すると、延滞した翌日からRailsのバッチ処理を介してシステムが延滞料金を請求する仕組みでした。
しかし、実際にはレンタル中継店舗のオペレーションや配送遅延の影響で、レンタルの開始が遅れ、その結果、予定より遅れてレンタルを開始したお客様に対して意図せず延滞した場合も延滞料金が請求される事態が発生していました。
その事態への対応としてはStripeのコンソールから請求を確認し、手動で返金対応を行わなければならず、システム運営スタッフに大きな負担がかかっていました。

<対応内容の回答>

<どんな課題があり>

上記の課題により、システム運営スタッフは、延滞料金が発生したユーザーが実際に延滞したのか、または他の要因で延滞が発生したのかを確認する必要がありました。この確認業務と返金業務がスタッフの負担となり、またエンドユーザーに対しても不必要な延滞料金の請求が行われることで、混乱を招いていました。


<どのような考察や仮説から>

この問題を解決するため、既存の延滞請求機能を見直し、延滞時点での自動請求が問題であると考え延滞を確認した際の新機能が必要ではないかと考えました。
具体的には延滞されている場合に請求処理が走るバッチの問題です。この時点では延滞料金を払うお客様と払わないお客様の２種類に分かれるため、この時点での請求処理に果たしてこのタイミングで必要な処理なのかという既存実装への疑問がありました。

<技術的な解決策を講じたのか>

請求のタイミングを変更するにあたって調査を行う中で、Stripe自体には直接請求を実行する機能と、請求をドラフトとして作成し任意のタイミングで実行できる機能があることがわかりました。
そこで、延滞が確定した時点での直接請求を、ドラフト作成に変更し、そのタイミングで運営スタッフおよびレンタル店舗に延滞情報を通知する仕組みをActionMailerを用いて実装しました。また、任意のタイミングで請求を行うためのAPIを追加し、運営スタッフ専用ページから請求処理を発火できるようにUIも併せて改修しました。
さらに、新しいオペレーションをスムーズに導入するために、運営スタッフとレンタル店舗向けにスライド資料を作成し、詳細な説明を行いました。

<結果に回答>

上記の施策により、運営スタッフの業務が簡素化され、今まで延滞発生から対応完了まで3〜4日かかっていた業務を、1〜2日に短縮することができました。スタッフの方からも要望に対し、機能・オペレーションの提案から実際に機能リリース後の説明まで対応してもらえて助かったと良いフィードバックをいただけました。
また運営スタッフから開発チームへの問い合わせも減少し、その分、他の機能開発や対応にリソースを集中させることができるようになりました。
